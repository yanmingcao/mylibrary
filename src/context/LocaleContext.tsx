"use client";

import { createContext, useContext, useEffect, useMemo, useState } from "react";

type Locale = "zh-Hans" | "en";

type LocaleContextValue = {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  t: (key: keyof typeof messages["zh-Hans"]) => string;
};

const messages = {
  "zh-Hans": {
    languageEnglish: "English",
    languageChinese: "ç®€ä½“ä¸­æ–‡",
    navBooks: "å›¾ä¹¦",
    navFamilies: "å®¶åº­",
    navMap: "åœ°å›¾",
    navAdmin: "ç®¡ç†å‘˜",
    signIn: "ç™»å½•",
    signOut: "é€€å‡ºç™»å½•",
    welcome: "æ¬¢è¿",
    loading: "åŠ è½½ä¸­...",
    headerTitle: "ğŸ“š VicLibrary",
    dashboardTitle: "ğŸ“Š æˆ‘çš„ä¹¦åº“",
    dashboardSubtitle: "ç®¡ç†ä½ çš„å›¾ä¹¦å’Œå€Ÿé˜…è¯·æ±‚",
    familyLabel: "å®¶åº­",
    addressLabel: "åœ°å€",
    myBooks: "ğŸ“š æˆ‘çš„å›¾ä¹¦",
    addBook: "+ æ·»åŠ å›¾ä¹¦",
    noBooks: "è¿˜æ²¡æœ‰æ·»åŠ å›¾ä¹¦",
    available: "å¯å€Ÿ",
    availableOnly: "ä»…çœ‹å¯å€Ÿ",
    tryAgain: "é‡è¯•",
    borrowed: "å·²å€Ÿå‡º",
    edit: "ç¼–è¾‘",
    currentLoans: "ğŸ“‹ å½“å‰å€Ÿé˜…",
    noBorrowings: "æš‚æ— å€Ÿé˜…",
    pendingRequests: "ğŸ“¨ å¾…å¤„ç†è¯·æ±‚",
    noPendingRequests: "æš‚æ— è¯·æ±‚",
    approve: "æ‰¹å‡†",
    reject: "æ‹’ç»",
    returnBook: "å½’è¿˜å›¾ä¹¦",
    dueDate: "åˆ°æœŸ",
    addBookTitle: "æ·»åŠ æ–°å›¾ä¹¦",
    editBookTitle: "ç¼–è¾‘å›¾ä¹¦",
    titleLabel: "ä¹¦å *",
    authorLabel: "ä½œè€… *",
    isbnLabel: "ISBN",
    isbnLookup: "æŸ¥è¯¢",
    isbnLookupLoading: "æŸ¥è¯¢ä¸­...",
    isbnLookupSuccess: "å·²è‡ªåŠ¨å¡«å…¥å›¾ä¹¦ä¿¡æ¯",
    isbnLookupNotFound: "æœªæ‰¾åˆ°è¯¥ISBNå¯¹åº”çš„å›¾ä¹¦",
    isbnLookupError: "æŸ¥è¯¢å¤±è´¥ï¼Œè¯·é‡è¯•",
    isbnInvalid: "è¯·è¾“å…¥æœ‰æ•ˆçš„ISBN-10æˆ–ISBN-13",
    languageLabel: "è¯­è¨€",
    conditionLabel: "æˆè‰²",
    descriptionLabel: "ç®€ä»‹",
    coverImageLabel: "å°é¢å›¾ç‰‡é“¾æ¥",
    saveChanges: "ä¿å­˜ä¿®æ”¹",
    cancel: "å–æ¶ˆ",
    newLabel: "å…¨æ–°",
    goodLabel: "è‰¯å¥½",
    fairLabel: "ä¸€èˆ¬",
    wornLabel: "ç£¨æŸ",
    homeTitle: "ç»´å¤šåˆ©äºšå®¶åº­ç¤¾åŒºå›¾ä¹¦é¦†",
    homeSubtitle: "åœ¨é‚»é‡Œé—´åˆ†äº«å›¾ä¹¦ï¼Œå…±å»ºé˜…è¯»ç¤¾åŒºã€‚",
    homeCtaBrowse: "æµè§ˆå›¾ä¹¦",
    homeCtaLogin: "ç™»å½•",
    homeCtaRegister: "åˆ›å»ºè´¦æˆ·",
    homeNoAccount: "è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ",
    booksTitle: "ğŸ“š å›¾ä¹¦é¦†",
    booksSubtitle: "æ¢ç´¢ç¤¾åŒºåˆ†äº«çš„å›¾ä¹¦",
    familiesTitle: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ç¤¾åŒºå®¶åº­",
    familiesSubtitle: "çœ‹çœ‹è°åœ¨åˆ†äº«å›¾ä¹¦",
    searchFamiliesLabel: "æœç´¢å®¶åº­",
    searchFamiliesPlaceholder: "æŒ‰å®¶åº­åç§°æˆ–åœ°å€æœç´¢...",
    loadingFamilies: "æ­£åœ¨åŠ è½½å®¶åº­...",
    errorLoadingFamilies: "åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚",
    errorLoadingBooks: "åŠ è½½å›¾ä¹¦å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚",
    noFamilies: "è¿˜æ²¡æœ‰å®¶åº­åŠ å…¥ã€‚",
    noFamiliesSearch: "æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å®¶åº­ã€‚",
    members: "æˆå‘˜",
    booksCount: "å›¾ä¹¦",
    membersLabel: "æˆå‘˜åˆ—è¡¨ï¼š",
    adminBadge: "ç®¡ç†å‘˜",
    previous: "ä¸Šä¸€é¡µ",
    next: "ä¸‹ä¸€é¡µ",
    loginTitle: "æ¬¢è¿å›æ¥",
    loginSubtitle: "ç™»å½•ä»¥ç»§ç»­",
    emailLabel: "é‚®ç®±",
    passwordLabel: "å¯†ç ",
    loginButton: "ç™»å½•",
    signInWithGoogle: "ä½¿ç”¨ Google ç™»å½•",
    signUpWithGoogle: "ä½¿ç”¨ Google æ³¨å†Œ",
    orContinueWith: "æˆ–",
    googleAccountLinked: "å·²å…³è” Google è´¦æˆ·",
    forgotPasswordTitle: "å¿˜è®°å¯†ç ",
    forgotPasswordSubtitle: "è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€ï¼Œæˆ‘ä»¬å°†å‘é€å¯†ç é‡ç½®é“¾æ¥ã€‚",
    forgotPasswordLabel: "é‚®ç®±åœ°å€",
    sendResetLink: "å‘é€é‡ç½®é“¾æ¥",
    forgotPasswordSuccess: "å¦‚æœè¯¥é‚®ç®±å·²æ³¨å†Œï¼Œæ‚¨å°†æ”¶åˆ°å¯†ç é‡ç½®é“¾æ¥ã€‚",
    forgotPasswordError: "å‘é€é‡ç½®é“¾æ¥å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚",
    forgotPasswordButton: "å‘é€é‡ç½®é“¾æ¥",
    backToLogin: "è¿”å›ç™»å½•",
    resetPasswordTitle: "é‡ç½®å¯†ç ",
    resetPasswordSubtitle: "è¾“å…¥æ‚¨çš„æ–°å¯†ç ã€‚",
    newPasswordLabel: "æ–°å¯†ç ",
    confirmNewPasswordLabel: "ç¡®è®¤æ–°å¯†ç ",
    resetPasswordSuccess: "å¯†ç å·²é‡ç½®æˆåŠŸã€‚",
    resetPasswordError: "é‡ç½®å¯†ç å¤±è´¥ï¼Œå¯èƒ½é“¾æ¥å·²è¿‡æœŸæˆ–æ— æ•ˆã€‚",
    resetPasswordButton: "é‡ç½®å¯†ç ",
    forgotPasswordLink: "å¿˜è®°å¯†ç ï¼Ÿ",
    noAccount: "è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ",
    registerLink: "æ³¨å†Œ",
    registerTitle: "åˆ›å»ºè´¦æˆ·",
    registerSubtitle: "åŠ å…¥ç¤¾åŒºå›¾ä¹¦é¦†ï¼Œå¼€å§‹åˆ†äº«å›¾ä¹¦ã€‚",
    personalInfo: "ä¸ªäººä¿¡æ¯",
    fullNameLabel: "å§“å",
    confirmPasswordLabel: "ç¡®è®¤å¯†ç ",
    passwordHelper: "è‡³å°‘ 6 ä¸ªå­—ç¬¦",
    familyInfo: "å®¶åº­ä¿¡æ¯",
    joinExistingFamily: "åŠ å…¥å·²æœ‰å®¶åº­",
    createNewFamily: "åˆ›å»ºæ–°å®¶åº­",
    familyNameLabel: "å®¶åº­åç§°",
    familyNameHelper: "å®¶åº­åç§°å”¯ä¸€",
    familyAddressLabel: "å®¶åº­åœ°å€",
    familyAddressHelper: "å¸®åŠ©é™„è¿‘å®¶åº­æ‰¾åˆ°å›¾ä¹¦",
    familyPhoneLabel: "å®¶åº­ç”µè¯ï¼ˆå¯é€‰ï¼‰",
    familyEmailLabel: "å®¶åº­é‚®ç®±ï¼ˆå¯é€‰ï¼‰",
    createAccount: "åˆ›å»ºè´¦æˆ·",
    creatingAccount: "æ­£åœ¨åˆ›å»ºè´¦æˆ·...",
    passwordMismatch: "ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ã€‚",
    passwordTooShort: "å¯†ç è‡³å°‘ 6 ä¸ªå­—ç¬¦ã€‚",
    networkError: "ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•ã€‚",
    signInError: "æ— æ³•ç™»å½•ã€‚",
    alreadyHaveAccount: "å·²æœ‰è´¦æˆ·ï¼Ÿ",
    signInLink: "ç™»å½•",
    backToBooks: "â† è¿”å›å›¾ä¹¦åˆ—è¡¨",
    bookInfo: "å›¾ä¹¦ä¿¡æ¯",
    statusLabel: "çŠ¶æ€",
    sharedBy: "åˆ†äº«è€…",
    borrowingStatus: "å€Ÿé˜…çŠ¶æ€",
    requestBorrow: "ç”³è¯·å€Ÿé˜…",
    requestBorrowTitle: "ç”³è¯·å€Ÿé˜…",
    fromLabel: "æ¥è‡ª",
    dueDateLabel: "å½’è¿˜æ—¥æœŸ *",
    borrowNote1: "æœ€å¤šå¯å€Ÿ 30 å¤©ã€‚",
    borrowNote2: "ä¹¦ä¸»ä¼šæ”¶åˆ°ä½ çš„ç”³è¯·é€šçŸ¥ã€‚",
    requesting: "æ­£åœ¨ç”³è¯·...",
    requestBook: "ç”³è¯·å€Ÿé˜…",
    mustLogin: "è¯·å…ˆç™»å½•å†ç”³è¯·å€Ÿé˜…",
    requestFailed: "ç”³è¯·å¤±è´¥",
    errorTitle: "é”™è¯¯",
    goBack: "è¿”å›",
    requestOwnFamilyError: "ä¸èƒ½å€Ÿé˜…è‡ªå·±å®¶åº­çš„å›¾ä¹¦ã€‚",
    requestedLabel: "ç”³è¯·æ—¥æœŸ",
    ownFamilyBook: "è¿™æ˜¯ä½ å®¶åº­çš„å›¾ä¹¦",
    manageBooks: "ç®¡ç†ä½ çš„å›¾ä¹¦",
    borrowedStatus: "å½“å‰å€Ÿå‡º",
    notAvailable: "ä¸å¯å€Ÿ",
    browseOtherBooks: "æµè§ˆå…¶ä»–å›¾ä¹¦",
    mapTitle: "ğŸ“ å›¾ä¹¦åœ°å›¾",
    mapSubtitle: "åœ¨åœ°å›¾ä¸Šå‘ç°é™„è¿‘çš„å®¶åº­å›¾ä¹¦",
    adminTitle: "ç³»ç»Ÿç®¡ç†å‘˜",
    adminSubtitle: "ç®¡ç†ç”¨æˆ·ã€å®¶åº­ä¸å†…å®¹",
    accessRestricted: "æ— è®¿é—®æƒé™",
    accessRestrictedDesc: "ä½ æ²¡æœ‰æƒé™æŸ¥çœ‹ç®¡ç†å‘˜å·¥å…·ã€‚",
    healthTitle: "å¥åº·çŠ¶æ€",
    usersLabel: "ç”¨æˆ·",
    familiesLabel: "å®¶åº­",
    booksLabel: "å›¾ä¹¦",
    newUsersLabel: "æ–°å¢ç”¨æˆ·ï¼ˆ24hï¼‰",
    errorsLabel: "é”™è¯¯ï¼ˆ24hï¼‰",
    backupStatusLabel: "å¤‡ä»½çŠ¶æ€",
    errorTrackingLabel: "é”™è¯¯è¿½è¸ª",
    searchUsersLabel: "æœç´¢ç”¨æˆ·",
    searchUsersPlaceholder: "å§“åæˆ–é‚®ç®±",
    search: "æœç´¢",
    roleLabel: "è§’è‰²",
    statusText: "çŠ¶æ€",
    statusActive: "å¯ç”¨ä¸­",
    statusInactive: "å·²åœç”¨",
    actionsLabel: "æ“ä½œ",
    promote: "æå‡æƒé™",
    demote: "å–æ¶ˆç®¡ç†å‘˜",
    deactivate: "åœç”¨",
    activate: "å¯ç”¨",
    usersNone: "æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·ã€‚",
    searchFamilies: "æœç´¢å®¶åº­",
    emptyFamiliesOnly: "ä»…æ˜¾ç¤ºç©ºå®¶åº­",
    notEmpty: "éç©º",
    delete: "åˆ é™¤",
    familiesNone: "æ²¡æœ‰æ‰¾åˆ°å®¶åº­ã€‚",
    searchBooks: "æœç´¢å›¾ä¹¦",
    searchBooksPlaceholder: "ä¹¦åæˆ–ä½œè€…",
    remove: "ç§»é™¤",
    booksNone: "æ²¡æœ‰æ‰¾åˆ°å›¾ä¹¦ã€‚",
    auditLog: "å®¡è®¡æ—¥å¿—",
    auditWhen: "æ—¶é—´",
    auditActor: "æ“ä½œäºº",
    auditAction: "æ“ä½œ",
    auditTarget: "ç›®æ ‡",
    auditNone: "æš‚æ— æ—¥å¿—ã€‚",
  },
  en: {
    languageEnglish: "English",
    languageChinese: "Simplified Chinese",
    navBooks: "Books",
    navFamilies: "Families",
    navMap: "Map",
    navAdmin: "Admin",
    signIn: "Sign In",
    signOut: "Logout",
    welcome: "Welcome",
    loading: "Loading...",
    headerTitle: "ğŸ“š VicLibrary",
    dashboardTitle: "ğŸ“Š Your Library",
    dashboardSubtitle: "Manage your books and borrowing requests",
    familyLabel: "Family",
    addressLabel: "Address",
    myBooks: "ğŸ“š Your Books",
    addBook: "+ Add Book",
    noBooks: "No books added yet",
    available: "Available",
    availableOnly: "Available only",
    tryAgain: "Try Again",
    borrowed: "Borrowed",
    edit: "Edit",
    currentLoans: "ğŸ“‹ Current Loans",
    noBorrowings: "No active borrowings",
    pendingRequests: "ğŸ“¨ Pending Requests",
    noPendingRequests: "No pending requests",
    approve: "Approve",
    reject: "Reject",
    returnBook: "Return Book",
    dueDate: "Due",
    addBookTitle: "Add New Book",
    editBookTitle: "Edit Book",
    titleLabel: "Title *",
    authorLabel: "Author *",
    isbnLabel: "ISBN",
    isbnLookup: "Lookup",
    isbnLookupLoading: "Looking up...",
    isbnLookupSuccess: "Book info filled in automatically",
    isbnLookupNotFound: "No book found for this ISBN",
    isbnLookupError: "Lookup failed, please try again",
    isbnInvalid: "Please enter a valid ISBN-10 or ISBN-13",
    languageLabel: "Language",
    conditionLabel: "Condition",
    descriptionLabel: "Description",
    coverImageLabel: "Cover Image URL",
    saveChanges: "Save Changes",
    cancel: "Cancel",
    newLabel: "New",
    goodLabel: "Good",
    fairLabel: "Fair",
    wornLabel: "Worn",
    homeTitle: "Victoria Families Community Library",
    homeSubtitle: "Share books among neighbors. Build community through reading.",
    homeCtaBrowse: "Browse Books",
    homeCtaLogin: "Login",
    homeCtaRegister: "Create Account",
    homeNoAccount: "Don't have an account?",
    booksTitle: "ğŸ“š Library",
    booksSubtitle: "Explore books shared by the community",
    familiesTitle: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Community Families",
    familiesSubtitle: "See who's sharing books in your neighborhood",
    searchFamiliesLabel: "Search Families",
    searchFamiliesPlaceholder: "Search by family name or address...",
    loadingFamilies: "Loading families...",
    errorLoadingFamilies: "Error loading families. Please try again.",
    errorLoadingBooks: "Error loading books. Please try again.",
    noFamilies: "No families have joined yet.",
    noFamiliesSearch: "No families found matching your search.",
    members: "members",
    booksCount: "books",
    membersLabel: "Members:",
    adminBadge: "Admin",
    previous: "Previous",
    next: "Next",
    loginTitle: "Welcome back",
    loginSubtitle: "Sign in to continue",
    emailLabel: "Email",
    passwordLabel: "Password",
    loginButton: "Sign In",
    signInWithGoogle: "Sign in with Google",
    signUpWithGoogle: "Sign up with Google",
    orContinueWith: "or",
    googleAccountLinked: "Google account linked",
    forgotPasswordTitle: "Forgot Password",
    forgotPasswordSubtitle: "Enter your email address and we'll send you a password reset link.",
    forgotPasswordLabel: "Email address",
    sendResetLink: "Send Reset Link",
    forgotPasswordSuccess: "If this email is registered, you'll receive a password reset link.",
    forgotPasswordError: "Failed to send reset link. Please try again.",
    forgotPasswordButton: "Send Reset Link",
    backToLogin: "Back to Login",
    resetPasswordTitle: "Reset Password",
    resetPasswordSubtitle: "Enter your new password.",
    newPasswordLabel: "New Password",
    confirmNewPasswordLabel: "Confirm New Password",
    resetPasswordSuccess: "Password reset successfully.",
    resetPasswordError: "Failed to reset password. The link may be expired or invalid.",
    resetPasswordButton: "Reset Password",
    forgotPasswordLink: "Forgot Password?",
    noAccount: "Don't have an account?",
    registerLink: "Register",
    registerTitle: "Create your account",
    registerSubtitle: "Join the community library and start sharing books.",
    personalInfo: "Personal Information",
    fullNameLabel: "Full Name",
    confirmPasswordLabel: "Confirm Password",
    passwordHelper: "Must be at least 6 characters",
    familyInfo: "Family Information",
    joinExistingFamily: "Join an existing family",
    createNewFamily: "Create a new family",
    familyNameLabel: "Family Name",
    familyNameHelper: "Family names are unique",
    familyAddressLabel: "Family Address",
    familyAddressHelper: "This helps other families find books nearby",
    familyPhoneLabel: "Family Phone (Optional)",
    familyEmailLabel: "Family Email (Optional)",
    createAccount: "Create account",
    creatingAccount: "Creating account...",
    passwordMismatch: "Passwords do not match.",
    passwordTooShort: "Password must be at least 6 characters.",
    networkError: "Network error. Please try again.",
    signInError: "Unable to sign in.",
    alreadyHaveAccount: "Already have an account?",
    signInLink: "Sign in",
    backToBooks: "â† Back to Books",
    bookInfo: "Book Information",
    statusLabel: "Status",
    sharedBy: "Shared By",
    borrowingStatus: "Borrowing Status",
    requestBorrow: "Request to Borrow",
    requestBorrowTitle: "Request to Borrow",
    fromLabel: "From",
    dueDateLabel: "Due Date *",
    borrowNote1: "You can borrow this book for up to 30 days.",
    borrowNote2: "The book owner will be notified of your request.",
    requesting: "Requesting...",
    requestBook: "Request Book",
    mustLogin: "You must be logged in to request a book",
    requestFailed: "Failed to request book",
    errorTitle: "Error",
    goBack: "Go Back",
    requestOwnFamilyError: "You cannot borrow books from your own family.",
    requestedLabel: "Requested",
    ownFamilyBook: "This book is from your family",
    manageBooks: "Manage Your Books",
    borrowedStatus: "Currently Borrowed",
    notAvailable: "Not Available",
    browseOtherBooks: "Browse Other Books",
    mapTitle: "ğŸ“ Library Map",
    mapSubtitle: "Find nearby families on the map",
    adminTitle: "System Admin",
    adminSubtitle: "Manage users, families, and content",
    accessRestricted: "Access Restricted",
    accessRestrictedDesc: "You do not have permission to view admin tools.",
    healthTitle: "Health",
    usersLabel: "Users",
    familiesLabel: "Families",
    booksLabel: "Books",
    newUsersLabel: "New Users (24h)",
    errorsLabel: "Errors (24h)",
    backupStatusLabel: "Backup Status",
    errorTrackingLabel: "Error Tracking",
    searchUsersLabel: "Search users",
    searchUsersPlaceholder: "Name or email",
    search: "Search",
    roleLabel: "Role",
    statusText: "Status",
    statusActive: "Active",
    statusInactive: "Inactive",
    actionsLabel: "Actions",
    promote: "Promote",
    demote: "Demote",
    deactivate: "Deactivate",
    activate: "Activate",
    usersNone: "No users found.",
    searchFamilies: "Search families",
    emptyFamiliesOnly: "Empty families only",
    notEmpty: "Not empty",
    delete: "Delete",
    familiesNone: "No families found.",
    searchBooks: "Search books",
    searchBooksPlaceholder: "Title or author",
    remove: "Remove",
    booksNone: "No books found.",
    auditLog: "Audit Log",
    auditWhen: "When",
    auditActor: "Actor",
    auditAction: "Action",
    auditTarget: "Target",
    auditNone: "No audit entries yet.",
  },
} as const;

const LocaleContext = createContext<LocaleContextValue | undefined>(undefined);

export function LocaleProvider({ children, initialLocale = "zh-Hans" }: { children: React.ReactNode; initialLocale?: Locale }) {
  const [locale, setLocale] = useState<Locale>(initialLocale);

  const updateLocale = (next: Locale) => {
    setLocale(next);
    window.localStorage.setItem("locale", next);
    if (typeof document !== "undefined") {
      document.cookie = `locale=${next}; path=/; max-age=31536000; SameSite=Lax`;
    }
  };

  const value = useMemo(
    () => ({
      locale,
      setLocale: updateLocale,
      t: (key: keyof typeof messages["zh-Hans"]) => messages[locale][key],
    }),
    [locale]
  );

  return (
    <LocaleContext.Provider value={value}>{children}</LocaleContext.Provider>
  );
}

export function useLocale() {
  const context = useContext(LocaleContext);
  if (!context) {
    throw new Error("useLocale must be used within a LocaleProvider.");
  }
  return context;
}
